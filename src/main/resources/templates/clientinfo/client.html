<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
	<title>AdminLTE 3 | DataTables</title>

	<!-- Google Font: Source Sans Pro -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" href="../../dist/css/adminlte.min.css">
	<!-- Toast Grid -->
	<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />

	<!-- jQuery -->
	<script src="../../plugins/jquery/jquery.min.js"></script>
	<!-- Bootstrap 4 -->
	<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- AdminLTE App -->
	<script src="../../dist/js/adminlte.min.js"></script>
	<!-- Toast Grid -->
	<script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.min.js"></script>
	<!-- Daum ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ -->
	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	
	<style>
		.client-container {
	        display: flex;
	        align-items: center;
	        gap: 15px; /* labelê³¼ input ê°„ê²© ìœ ì§€ */
	    }
						
		.client-label	{
	        flex: 0 0 auto;
	        white-space: nowrap;
	        text-align: right;
	    }
		
		.client-input {
	        width: 150px;
	    }
		
		.client-select {
			        min-width: 120px;
			    }	
	</style>
	
</head>
<body class="hold-transition sidebar-mini">
	<div class="wrapper">

		<!-- ìƒë‹¨ ë©”ë‰´ -->
		<nav th:replace="~{includes/navbar :: navbar}"></nav>

		<!-- ì¢Œì¸¡ ë©”ë‰´ -->
		<aside th:replace="~{includes/sidebar :: sidebar}"></aside>

		<!-- ê±°ë˜ì²˜ ì½”ë“œ ì¤‘ë³µì²˜ë¦¬ ê²€ì¦ ëª¨ë‹¬ -->		
		<nav th:replace="~{includes/modals/clientCodeAdd :: clientCodeAdd}"></nav>

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- ì½˜í…ì¸  í—¤ë” (Page header) -->
			<nav th:replace="~{includes/pageHeader :: pageHeader}"></nav>
			
			<!-- ë©”ì¸ ì½˜í…ì¸  -->
			<section class="content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
									<div class="d-flex justify-content-between">
								        <div class="client-container">
											<!-- ê±°ë˜ì²˜ ìœ í˜• -->
										    <label class="col-form-label client-label" >ê±°ë˜ì²˜ ìœ í˜•</label>
											<select class="client form-control client-select" name="clientType">
										        <option value="" selected="selected">ì „ì²´</option>
										        <option value="ë§¤ì…ì‚¬">ë§¤ì…ì‚¬</option>
										        <option value="ë§¤ì¶œì‚¬">ë§¤ì¶œì‚¬</option>
										    </select>

											<!-- ê±°ë˜ì²˜ëª… -->
										    <label class="col-form-label client-label" >ê±°ë˜ì²˜ëª…</label>
											<input type="text" class="form-control client-input" id="clientName">
											
										    <!-- ê±°ë˜ìƒíƒœ -->
										    <label class="col-form-label client-label" >ê±°ë˜ìƒíƒœ</label>
										    <select class="client form-control client-select" name="clientStatus">
										        <option value="" selected="selected">ì „ì²´</option>
										        <option value="ê±°ë˜ì¤‘">ê±°ë˜ì¤‘</option>
										        <option value="ê±°ë˜ì¤‘ì§€">ê±°ë˜ì¤‘ì§€</option>
										    </select>
										</div>
								        <!-- ì¡°íšŒ ë²„íŠ¼ -->
								        <input type="button" id="btn_client_search" class="btn btn-primary" value="ì¡°íšŒ">
								    </div>
								</div>
								<div class="card-header">
									<div class="row">
										<div class="col-6">
											<p class="font-weight-bold" style="margin-bottom: 0px; padding-top: 8px;">ê±°ë˜ì²˜ ëª©ë¡</p>
										</div>
										<div class="col-6">
											<div class="card-tools" style="text-align: right;">
												<input type="button" id="btn_client_add_row" class="btn btn-primary" value="í–‰ì¶”ê°€" style="display : none;">
												<input type="button" id="btn_client_remove_row" class="btn btn-primary" value="í–‰ì‚­ì œ" style="display : none;">
												<input type="button" id="btn_client_toggleEditMode" class="btn btn-primary" value="í¸ì§‘">
												<input type="button" id="btn_client_modify" class="btn btn-primary" value="ì €ì¥">
												<input type="button" id="btn_client_delete" class="btn btn-primary" value="ì‚­ì œ">
											</div>
										</div>
									</div>
								</div>
								<div class="card-body" id="clientGrid">
									<!-- Toast Grid Ajax -->
								</div>
							<!-- /.card-body -->
							</div>
						<!-- /.card -->
						</div>
					<!-- /.col -->
					</div>
				<!-- /.row -->
				<div class="row">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<div class="row">
									<div class="col-6">
										<p class="font-weight-bold" style="margin-bottom: 0px; padding-top: 8px;">ê±°ë˜ì²˜ ìƒì„¸</p>
									</div>
									<div class="col-6">
										<div class="card-tools" id="btn_group_client" style="text-align: right; display: none;">
											<input type="button" id="btn_client_edit" class="btn btn-primary" value="í¸ì§‘">
											<input type="button" id="btn_client_save" class="btn btn-primary" value="ì €ì¥">
											<input type="button" id="btn_client_remove" class="btn btn-primary" value="ì‚­ì œ">
										</div>
									</div>
								</div>
							</div>
							<div class="card-body" id="clientDetailGrid">
								<!-- Toast Grid Ajax -->
							</div>
						<!-- /.card-body -->
						</div>
					<!-- /.card -->
					</div>
				</div>
				<!-- /.row -->
				</div>
			<!-- /.container-fluid -->
			</section>
		<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->
		<!-- ì¢Œì¸¡ ë©”ë‰´ -->
		<footer th:replace="~{includes/footer :: footer}"></footer>
		<!-- /.ì¢Œì¸¡ ë©”ë‰´ -->
		<!-- Control Sidebar -->
		<aside class="control-sidebar control-sidebar-dark">
		<!-- Control sidebar content goes here -->
		</aside>
	<!-- /.control-sidebar -->
	</div>
	<!-- ./wrapper -->
	
	<style>
	    .selected-row {
	        background-color: #d1ffd6;
	    }
	    .deselected-row {
	        background-color: #ffd1d1;
	    }
	</style>
	
	<!-- Page specific script -->
	<script th:inline="javascript">
		// ê±°ë˜ì²˜ ì •ë³´
		let clientGrid = null;
		let allData = [];
		const clientUrl = '/clientinfo/client';
		const clientDataSource = {
			api: {
			    readData: {url: clientUrl, method: 'GET'},
				modifyData: { url: clientUrl, method: 'PUT' },
				deleteData: {url: clientUrl, method: 'DELETE', headers: {'X-Delete-IDs': ''}}
			},
			contentType: 'application/json',
	    };
		let clientCurrentSelectedRowKey = null;
		let clientIsEditModeEnabled = false; 
		const client_columns = [
			{
		        header: 'ê±°ë˜ì²˜ ì½”ë“œ',
		        name: 'CLIENT_ID',
		        align: 'center',
		        editor: null,
		        formatter: function({ value }) {
		            return `<span style="font-weight: bold;">${value}</span>`;
		        }
		    },
            {header: 'ê±°ë˜ì²˜ëª…', name: 'CLIENT_NAME', align: 'left', editor: null},
			{
			    header: 'ê±°ë˜ì²˜ ìœ í˜•',
			    name: 'CLIENT_TYPE',
			    align: 'center',
			    editor: null,
			    formatter: function({ value }) {
			        let color = value === 'ë§¤ì…ì‚¬' ? '#005500' : value === 'ë§¤ì¶œì‚¬' ? '#C72F7A' : 'black';
			        return `<span style="color: ${color};">${value}</span>`;
			    }
			},
            {
				header: 'ì‚¬ì—…ìë²ˆí˜¸', 
				name: 'BUSINESS_NUMBER', 
				align: 'left', 
				editor: null,
				formatter: function({ value }) {
				       if (!value) return ''; // ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
				       
				       const cleanValue = value.replace(/\D/g, ''); // ìˆ«ìë§Œ ë‚¨ê¸°ê¸°
				       
				       if (cleanValue.length === 10) {
				           return `${cleanValue.slice(0, 2)}-${cleanValue.slice(2, 5)}-${cleanValue.slice(5)}`;
				       }
				       
				       return value; // 10ìë¦¬ê°€ ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
				   }
			},
            {header: 'ëŒ€í‘œì', name: 'CEO_NAME', align: 'left', editor: null},
            {header: 'ì „í™”ë²ˆí˜¸', name: 'CLIENT_TEL', align: 'left', editor: null},
			{
			    header: 'ê±°ë˜ìƒíƒœ',
			    name: 'CLIENT_STATUS',
			    align: 'center',
			    editor: null,
			    formatter: function({ value }) {
			        if (value === 'ê±°ë˜ì¤‘') {
			            return `<span style="color: #0030DB; font-weight: bold;">${value}</span>`;
			        } else if (value === 'ê±°ë˜ì¤‘ì§€') {
			            return `<span style="text-decoration: line-through; color: #5D5D5D;">${value}</span>`;
			        }
			        return value;
			    }
			}
        ];
		
		// ê±°ë˜ì²˜ ìƒì„¸
		let clientDetailGrid = null;
		const clientDetailUrl = '/clientinfo/detail';
		const clientDetailDataSource = {
			api: {
			    readData: {url: clientDetailUrl, method: 'GET'},
				modifyData: { url: clientDetailUrl, method: 'PUT' },
				deleteData: {url: clientDetailUrl, method: 'DELETE', headers: {'X-Delete-IDs': ''}}
			},
			contentType: 'application/json',
	    };
		let clientDetailCurrentSelectedRowKey = null;
		let clientDetailIsEditModeEnabled = false; 
		const clientDetail_columns = [
            {header: 'ìš°í¸ë²ˆí˜¸', name: 'ZIPCODE', align: 'center', width: 100, editor: null},
            {header: 'ê±°ë˜ì²˜ ì£¼ì†Œ', name: 'CLIENT_ADDRESS', align: 'left', width: 300, editor: null},
            {header: 'ìƒì„¸ì£¼ì†Œ', name: 'ADDRESS_DETAIL', align: 'left', width: 200, editor: null},
            {header: 'ë‹´ë‹¹ìëª…', name: 'RESP_NAME', align: 'center', width: 150, editor: null},
			{header: 'ë‹´ë‹¹ì ë©”ì¼', name: 'RESP_EMAIL', align: 'left', width: 150, editor: null},
			{header: 'ë¹„ê³ ', name: 'DESCRIPTION', align: 'center', width: 300, editor: null},
			{header: 'ê±°ë˜ì²˜ ì½”ë“œ', name: 'CLIENT_ID', align: 'center', editor: null, hidden: true},
        ];
		
		const TextInputRenderer = function(props) {
			const el = document.createElement('input');
			el.type = 'text';
		 	el.style.width = 'calc(100% - 10px)';
		 	el.style.padding = '6px 7px';
		  	el.style.border = 'solid 1px #ddd';
		  	el.style.margin = 'auto 5px';
		  	
		  	this.el = el;
		  	this.render(props);
		}

		TextInputRenderer.prototype.getElement = function () {
			return this.el;
		}
		
		TextInputRenderer.prototype.render = function (props) {
			this.el.value = props.value;
		}
		
		
		const SelectBoxRenderer = function (props) {
		    const el = document.createElement('select'); // select ìš”ì†Œ ìƒì„±
		    el.style.width = 'calc(90% - 10px)';
		    el.style.padding = '6px 7px';
		    el.style.border = 'solid 1px #ddd';
		    el.style.margin = 'auto 5px';

		    // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ì„¤ì •
		    const options = [
		        { text: 'ê±°ë˜ì¤‘', value: 'ê±°ë˜ì¤‘' },
		        { text: 'ê±°ë˜ì¤‘ì§€', value: 'ê±°ë˜ì¤‘ì§€' },
		        { text: 'ë§¤ì…ì‚¬', value: 'ë§¤ì…ì‚¬' },
		        { text: 'ë§¤ì¶œì‚¬', value: 'ë§¤ì¶œì‚¬' }
		    ];

		    options.forEach(option => {
		        const optionEl = document.createElement('option');
		        optionEl.value = option.value;
		        optionEl.textContent = option.text;
		        if (props.value === option.value) {
		            optionEl.selected = true; // í˜„ì¬ ê°’ê³¼ ì¼ì¹˜í•˜ë©´ ì„ íƒ
		        }
		        el.appendChild(optionEl);
		    });

		    this.el = el;
		    this.render(props);
		};

		SelectBoxRenderer.prototype.getElement = function () {
		    return this.el;
		};

		SelectBoxRenderer.prototype.render = function (props) {
		    this.el.value = props.value;
		};
		
		const TextInputBtnRenderer = function(props) {
		    const container = document.createElement('div');
		    container.style.display = 'flex';
		    container.style.alignItems = 'center';
		    container.style.gap = '5px';
		    
		    const el = document.createElement('input');
		    el.type = 'text';
		    el.style.width = 'calc(100% - 10px)';
		    el.style.padding = '6px 7px';
		    el.style.border = 'solid 1px #ddd';
		    el.style.color = 'solid 1px #ddd';
		    el.style.marginLeft = '1px';
		    el.setAttribute('disabled', true); // ì…ë ¥ ë° í´ë¦­ ë¹„í™œì„±í™”
			
			// ì…ë ¥ í•„ë“œì™€ ë²„íŠ¼ì„ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆì— ì¶”ê°€
			container.appendChild(el);
			
		TextInputBtnRenderer.prototype.getElement = function () {
		    return this.el;
		}

		TextInputBtnRenderer.prototype.render = function (props) {
		    this.input.value = props.value;
		}
		
		// CLIENT_ID, ZIPCODE ê¸°ì¡´ê°’ì€ ìˆ˜ì • ë¶ˆê°€ ì¡°ê±´
			if (!((props.columnInfo.name == 'CLIENT_ID' || props.columnInfo.name == 'ZIPCODE')
				&& clientGrid.getValue(props.rowKey, 'isNew') == null)) {
				const button = document.createElement('button');
			    button.textContent = 'ğŸ”';
			    button.style.border = 'solid 1px #007BFF';
			    button.style.background = 'white';
			    button.style.color = 'white';
			    button.style.padding = '6px 10px';
			    button.style.cursor = 'pointer';
			    button.style.borderRadius = '4px';
			    button.style.marginRight = '5px';
				
				container.appendChild(button);
					
				button.addEventListener('click', function() {
					const row = props.rowKey;
					const column = props.columnInfo.name;
					// props.formattedValueë¡œ ê°€ì ¸ì˜¤ë©´ ëª¨ë‹¬ ë‹¤ì‹œ ë„ìš¸ ë•Œ ê°’ì„ ëª»ë°›ì•„ì˜´.
					const value = clientGrid.getValue(row, column);
					
					switch (column) {
						case 'CLIENT_ID':
							$("#clientCode").val(value);
							$("#clientRow").val(row);
							$("#clientColumn").val(column);
							$('#clientCodeAdd').modal();
						break;
						case 'CLIENT_ADDRESS':
		                    // CLIENT_ADDRESS í´ë¦­ ì‹œ, ë‹¤ìŒì£¼ì†ŒAPI í˜¸ì¶œ
		                    openDaumPostcode(row, column);
		                    break;
					}
			    });
			}
			
		    this.el = container;
		    this.input = el;
		    this.render(props);
		}
		
		// ë‹¤ìŒì£¼ì†ŒAPI í˜¸ì¶œ í•¨ìˆ˜
		function openDaumPostcode(row, column) {
		    new daum.Postcode({
		        oncomplete: function(data) {
		            // ìš°í¸ë²ˆí˜¸
		            const zipcode = data.zonecode;
		            // ì£¼ì†Œ
		            const address = data.roadAddress || data.jibunAddress;

		            // ìš°í¸ë²ˆí˜¸ì™€ ì£¼ì†Œë¥¼ ê·¸ë¦¬ë“œì— ìë™ìœ¼ë¡œ ì±„ìš°ê¸°
		            clientDetailGrid.setValue(row, 'ZIPCODE', zipcode);
		            clientDetailGrid.setValue(row, 'CLIENT_ADDRESS', address);
		        }
		    }).open();
		}
		
		$(function () {
			clientInit();
		});
		
		// ê±°ë˜ì²˜ ëª©ë¡
		function clientInit() {
			clientGrid = new tui.Grid({
		        el: document.getElementById('clientGrid'),
		        data: clientDataSource,
		        scrollX: true,
		        scrollY: true,
		        bodyHeight: 250,
		        rowHeaders: ['checkbox'],
				editingEvent: 'click',
		        columns: client_columns,
		    });

		    clientGrid.on('failResponse', function(ev) {
		        alert(JSON.parse(ev.xhr.responseText).message);
		    });
			
			// ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¨ í›„ allDataì— ì €ì¥
			// ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ”ë° ì•½ê°„ì˜ ì‹œê°„ì´ ê±¸ë¦¼ (ì•½ 110~250ms)
			setTimeout(function () {
			    allData = clientGrid.getData();
			    console.log("ì „ì²´ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:", allData);
			}, 350);
			
			clientGrid.on('editingStart', function(ev) {
			    const {rowKey, columnName, value} = ev;
			    const rowData = clientGrid.getRow(rowKey);
			});

			clientGrid.on('click', (ev) => {
			    if (ev.targetType != "cell" || clientIsEditModeEnabled) {
					return;
				}

			    const newRowKey = ev.rowKey;
				
				// ìƒˆë¡œ ì¶”ê°€ëœ í–‰ì€ í´ë¦­ ì•ˆë˜ë„ë¡.
				if (clientGrid.getRow(newRowKey).isNew) {
					return;
				}

			    if (clientCurrentSelectedRowKey != null) {
			        clientGrid.removeRowClassName(clientCurrentSelectedRowKey, 'selected-row');
			    }
				
				if (clientDetailGrid) {
					clientDetailGrid.destroy(); // ê±°ë˜ì²˜ ìƒì„¸ ê·¸ë¦¬ë“œ ì œê±°
					clientDetailGrid = null;
				}

			    if (clientCurrentSelectedRowKey != newRowKey) {
			        clientGrid.addRowClassName(newRowKey, 'selected-row');
			        clientCurrentSelectedRowKey = newRowKey;
				
				   const clientID = clientGrid.getValue(newRowKey, 'CLIENT_ID');
				    console.log("ì„ íƒëœ ê±°ë˜ì²˜ ID: ", clientID); // clientIDê°€ ì œëŒ€ë¡œ ê°€ì ¸ì™€ì§€ëŠ”ì§€ í™•ì¸

				    if (clientID) {
				        clientDetailInit(clientID); // clientIDê°€ ìˆì„ ê²½ìš°ì—ë§Œ clientDetailInit í˜¸ì¶œ
				        clientCurrentSelectedID = clientID;
				        $("#btn_group_client").show();
				    }
				} else {
				    clientCurrentSelectedRowKey = null;
				    clientCurrentSelectedID = null;
				    $("#btn_group_client").hide();
				}
			});
		}
		
		// í–‰ì¶”ê°€
		$("#btn_client_add_row").on("click", function () {
		    const newRowKey = clientGrid.appendRow(
		        {
		        	"CLIENT_ID": '',
		        	"CLIENT_NAME": '',
		        	"CLIENT_TYPE": '',
		        	"BUSINESS_NUMBER": '',
		        	"CEO_NAME": '',
		        	"CLIENT_TEL": '',
		        	"CLIENT_STATUS": 'ê±°ë˜ì¤‘',
		            isNew: true
		        },
		        {focus: true}
		    );
		});
		
		// ìˆ˜ì • ëª¨ë“œ í† ê¸€ ë²„íŠ¼ ì´ë²¤íŠ¸
		$("#btn_client_toggleEditMode").on("click", function () {
		    clientIsEditModeEnabled = !clientIsEditModeEnabled; // ìˆ˜ì • ëª¨ë“œ ìƒíƒœ í† ê¸€
		    
		    if (clientIsEditModeEnabled) {
				$("#btn_client_add_row").show();
				$("#btn_client_remove_row").show();
		    } else {
		    	$("#btn_client_add_row").hide();
				$("#btn_client_remove_row").hide();
		    }
		    
		    if (clientIsEditModeEnabled) {
		        clientGrid.setColumns([
		        	{header: 'ê±°ë˜ì²˜ ì½”ë“œ *', name: 'CLIENT_ID', align: 'center', renderer: { type: TextInputBtnRenderer }},
		            {header: 'ê±°ë˜ì²˜ëª… *', name: 'CLIENT_NAME', align: 'left', editor: 'text', renderer: { type: TextInputRenderer }},
		            {
						header: 'ê±°ë˜ì²˜ ìœ í˜• *', 
						name: 'CLIENT_TYPE', 
						align: 'center', 
						editor: {
							type: 'select',  // ë“œë¡­ë‹¤ìš´ íƒ€ì… ì„¤ì •
							options: {
								listItems: [
									{ text: 'ë§¤ì…ì‚¬', value: 'ë§¤ì…ì‚¬' },
						        	{ text: 'ë§¤ì¶œì‚¬', value: 'ë§¤ì¶œì‚¬' }
						      	]
						    }
							  },
						  renderer: { type: SelectBoxRenderer }}, 
		            {header: 'ì‚¬ì—…ìë²ˆí˜¸', name: 'BUSINESS_NUMBER', align: 'left', editor: 'text', renderer: { type: TextInputRenderer }},
		            {header: 'ëŒ€í‘œì', name: 'CEO_NAME', align: 'left', editor: 'text', renderer: { type: TextInputRenderer }},
		            {header: 'ì „í™”ë²ˆí˜¸', name: 'CLIENT_TEL', align: 'left', editor: 'text', renderer: { type: TextInputRenderer }},
		            {
						header: 'ê±°ë˜ìƒíƒœ *',
						name: 'CLIENT_STATUS', 
						align: 'center', 
						editor: {
							type: 'select',  // ë“œë¡­ë‹¤ìš´ íƒ€ì… ì„¤ì •
							options: {
								listItems: [
									{ text: 'ê±°ë˜ì¤‘', value: 'ê±°ë˜ì¤‘' },
						        	{ text: 'ê±°ë˜ì¤‘ì§€', value: 'ê±°ë˜ì¤‘ì§€' }
						      	]
						    }
					  			},
				  			renderer: { type: SelectBoxRenderer }}, 
		        ]);
		    } else {
		        clientGrid.finishEditing();  // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì…€ ì¢…ë£Œë¥¼ ì•ˆí•˜ë©´ ìˆ˜ì •ëª¨ë“œ ì¢…ë£Œì‹œ ê°’ì´ ì´ˆê¸°í™” ë˜ë²„ë¦¼
		        clientGrid.setColumns(client_columns);
		    }
		});


		
		$("#btn_client_remove_row").on("click", function () {
		    const rowCount = clientGrid.getRowCount(); // í˜„ì¬ í–‰ ê°œìˆ˜ ê°€ì ¸ì˜¤ê¸°
		    
		    const allRows = clientGrid.getData(); // ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
		    const newRows = allRows.filter(row => row.isNew); // ìƒˆë¡œ ì¶”ê°€ëœ í–‰ë§Œ í•„í„°ë§
		    
		    if (newRows.length === 0) {
		        alert("ì‚­ì œí•  ìˆ˜ ìˆëŠ” ì‹ ê·œ í–‰ì´ ì—†ìŠµë‹ˆë‹¤.");
		        return;
		    }

		    const lastRowKey = clientGrid.getRowAt(rowCount - 1).rowKey; // ë§ˆì§€ë§‰ í–‰ì˜ rowKey ê°€ì ¸ì˜¤ê¸°
		    clientGrid.removeRow(lastRowKey); // ë§ˆì§€ë§‰ í–‰ ì‚­ì œ
		});

		$("#btn_client_modify").on("click", function() {
			clientGrid.finishEditing();  // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì…€ ì¢…ë£Œë¥¼ ì•ˆí•˜ë©´ ê°’ì´ ì´ˆê¸°í™” ë˜ë²„ë¦¼
			
		    let createdRows = clientGrid.getModifiedRows().createdRows;
		    let updatedRows = clientGrid.getModifiedRows().updatedRows;
		    
		    // í•„ìˆ˜ ì…ë ¥ ì»¬ëŸ¼
		    const requiredFields = ["CLIENT_ID", "CLIENT_NAME", "CLIENT_TYPE", "CLIENT_STATUS"];

		    let validCreatedRows = createdRows.filter(row =>
		        requiredFields.every(field => 
		        	row[field] && row[field].trim() !== ''
		        )
		    );
		    
		    let validUpdatedRows = updatedRows.filter(row =>
		        requiredFields.every(field => 
		        	row[field] && row[field].trim() !== ''
		        )
		    );
		    
		    if (createdRows.length == 0 && updatedRows.length == 0) {
		    	alert("ìˆ˜ì •ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
		        return;
		    }

			if (createdRows.length > 0) {
				if ((validCreatedRows.length == 0)
					|| (validCreatedRows.length != createdRows.length)) {
					alert("í•„ìˆ˜ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
			        return;
				}
			}
				
			if (updatedRows.length > 0 && validUpdatedRows.length == 0) {
				alert("í•„ìˆ˜ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
		        return;
			}
			
			clientGrid.request('modifyData');
			clientGrid.readData(1, null, true);  // ê·¸ë¦¬ë“œ ìƒˆë¡œê³ ì¹¨
			clientGrid.setColumns(client_columns);  // ìˆ˜ì •ëª¨ë“œ í•´ì œ (ìƒˆë¡œ ë Œë”ë§)
			
			clientIsEditModeEnabled = false;
	    	$("#btn_client_add_row").hide();
			$("#btn_client_remove_row").hide();
		});
		
        $("#btn_client_delete").on("click", function() {
			clientGrid.removeCheckedRows();
			
			// ë°˜ë“œì‹œ removeCheckedRows()í›„ì— ì‹¤í–‰ ìˆœì„œ
			// DELETEëŠ” bodyê°€ ì—†ê³  urlê³¼ headerë§Œ ìˆìŒ, ê¸°ë³¸ê°’ url -> urlëŒ€ì‹  headerì— ë‹´ì•„ ë³´ëƒ„
			const ids = clientGrid.getModifiedRows().deletedRows
				.map(row => encodeURIComponent(row.CLIENT_ID))  // í•œê¸€ ë³€í™˜
				.join(',');
			clientDataSource.api.deleteData.headers['X-Delete-IDs'] = ids;
			
		    clientGrid.request('deleteData');
			clientGrid.reloadData();  // ì‹¤íŒ¨ì‹œ í…Œì´ë¸” ë¦¬ë¡œë“œ
		});
		
		
		
		// ê±°ë˜ì²˜ ìƒì„¸
		function clientDetailInit(CLIENT_ID) {
			
			console.log(clientDetailDataSource.api.readData);
	        console.log(clientDetailDataSource.api.readData.initParams);
			
			if (!clientDetailDataSource.api.readData.initParams) {
			    clientDetailDataSource.api.readData.initParams = {}; // initParams ì´ˆê¸°í™”
			}
			
			// íŒŒë¼ë¯¸í„° ì„¤ì •
			clientDetailDataSource.api.readData.initParams.CLIENT_ID = CLIENT_ID;
			
			if (clientDetailGrid) {
				clientDetailGrid.destroy(); // ê¸°ì¡´ ê·¸ë¦¬ë“œ ì œê±°
				clientDetailGrid = null;
			}
			
			clientDetailGrid = new tui.Grid({
		        el: document.getElementById('clientDetailGrid'),
		        data: clientDetailDataSource,
		        scrollX: true,
		        scrollY: true,
		        bodyHeight: 250,
		        rowHeaders: ['checkbox'],
		        columns: clientDetail_columns,
		    });
			
			$("#btn_group_client").show();

		    clientDetailGrid.on('failResponse', function(ev) {
		        alert(JSON.parse(ev.xhr.responseText).message);
		    });
		}
		
		// ìˆ˜ì • ëª¨ë“œ í† ê¸€ ë²„íŠ¼ ì´ë²¤íŠ¸
		$("#btn_client_edit").on("click", function () {
		    clientIsEditModeEnabled = !clientIsEditModeEnabled; // ìˆ˜ì • ëª¨ë“œ ìƒíƒœ í† ê¸€
		    
		    if (clientIsEditModeEnabled) {
		        clientDetailGrid.setColumns([
					{ header: 'ìš°í¸ë²ˆí˜¸', name: 'ZIPCODE', align: 'center', width: 150, renderer: { type: TextInputBtnRenderer }},
					{ header: 'ê±°ë˜ì²˜ ì£¼ì†Œ', name: 'CLIENT_ADDRESS', align: 'center', editor: 'text', width: 300, renderer: { type: TextInputBtnRenderer }},
					{ header: 'ìƒì„¸ì£¼ì†Œ', name: 'ADDRESS_DETAIL', align: 'center', editor: 'text', width: 200, renderer: { type: TextInputRenderer }},
		            { header: 'ë‹´ë‹¹ìëª…', name: 'RESP_NAME', align: 'left', editor: 'text', width: 150, renderer: { type: TextInputRenderer }},
		            { header: 'ë‹´ë‹¹ì ë©”ì¼', name: 'RESP_EMAIL', align: 'left', editor: 'text', width: 150, renderer: { type: TextInputRenderer }},
		            { header: 'ë¹„ê³ ', name: 'DESCRIPTION', align: 'center', editor: 'text', width: 300, renderer: { type: TextInputRenderer }},
					{ header: 'ê±°ë˜ì²˜ ì½”ë“œ', name: 'CLIENT_ID', align: 'center', editor: null, hidden: true},
		        ]);
		    } else {
		        clientDetailGrid.finishEditing(); // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì…€ ì¢…ë£Œ
		        clientDetailGrid.setColumns(clientDetail_columns);
			    }
		});

		// ì €ì¥
		$("#btn_client_save").on("click", function() {
			clientDetailGrid.finishEditing();  // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì…€ ì¢…ë£Œë¥¼ ì•ˆí•˜ë©´ ê°’ì´ ì´ˆê¸°í™” ë˜ë²„ë¦¼
			
		    let createdRows = clientDetailGrid.getModifiedRows().createdRows;
		    let updatedRows = clientDetailGrid.getModifiedRows().updatedRows;
		    
		    // í•„ìˆ˜ ì…ë ¥ ì»¬ëŸ¼
		    const requiredFields = ["RESP_NAME"];

		    let validCreatedRows = createdRows.filter(row =>
		        requiredFields.every(field => 
		        	row[field] && row[field].trim() !== ''
		        )
		    );
		    
		    let validUpdatedRows = updatedRows.filter(row =>
		        requiredFields.every(field => 
		        	row[field] && row[field].trim() !== ''
		        )
		    );
		    
		    if (createdRows.length == 0 && updatedRows.length == 0) {
		    	alert("ìˆ˜ì •ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
		        return;
		    }

			if (createdRows.length > 0) {
				if ((validCreatedRows.length == 0)
					|| (validCreatedRows.length != createdRows.length)) {
					alert("í•„ìˆ˜ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
			        return;
				}
			}
				
			if (updatedRows.length > 0 && validUpdatedRows.length == 0) {
				alert("í•„ìˆ˜ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
		        return;
			}
			
			clientDetailGrid.request('modifyData');
			clientDetailGrid.reloadData();  // ê·¸ë¦¬ë“œ ìƒˆë¡œê³ ì¹¨ 
			clientDetailGrid.setColumns(clientDetail_columns);  // ìˆ˜ì •ëª¨ë“œ í•´ì œ (ìƒˆë¡œ ë Œë”ë§)
		});
		
		$("#btn_client_remove").on("click", function() {
			clientDetailGrid.removeCheckedRows();
			
			const ids = clientDetailGrid.getModifiedRows().deletedRows
				.map(row => encodeURIComponent(row.CLIENT_ID))  // í•œê¸€ ë³€í™˜
				.join(',');
			clientDetailDataSource.api.deleteData.headers['X-Delete-IDs'] = ids;
			
		    clientDetailGrid.request('deleteData');
			clientDetailGrid.reloadData();  // ì‹¤íŒ¨ì‹œ í…Œì´ë¸” ë¦¬ë¡œë“œ
		});
		
		$("#btn_client_search").on("click", function() {
					
		    const clientType = $("select[name='clientType']").val();
		    const clientName = $("#clientName").val().trim().toLowerCase();
			const clientStatus = $("select[name='clientStatus']").val(); // ì‚¬ìš©ì—¬ë¶€ (ì„ íƒê°’)

		    // í•„í„°ë§ëœ ë°ì´í„° ì¶”ì¶œ
		    const filteredData = allData.filter(item => {
				return	(clientType === "" || item.CLIENT_TYPE === clientType) &&
		        		(clientName === "" || item.CLIENT_NAME.toLowerCase().includes(clientName)) &&
						(clientStatus === "" || item.CLIENT_STATUS === clientStatus);
		    });
			
			console.log(filteredData);

		    // í•„í„°ë§ëœ ë°ì´í„°ë¡œ ê·¸ë¦¬ë“œ ê°±ì‹ 
		    clientGrid.resetData(filteredData);
		});
		
	</script>

</body>
</html>