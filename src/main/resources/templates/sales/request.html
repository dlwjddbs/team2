<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
	<title>AdminLTE 3 | DataTables</title>

	<!-- Google Font: Source Sans Pro -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" href="../../dist/css/adminlte.min.css">
	<!-- Toast Grid -->
	<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />

	<!-- jQuery -->
	<script src="../../plugins/jquery/jquery.min.js"></script>
	<!-- Bootstrap 4 -->
	<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- AdminLTE App -->
	<script src="../../dist/js/adminlte.min.js"></script>
	<!-- Toast Grid -->
	<script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.min.js"></script>
</head>
<body class="hold-transition sidebar-mini">
	<div class="wrapper">

		<!-- ÏÉÅÎã® Î©îÎâ¥ -->
		<nav th:replace="~{includes/navbar :: navbar}"></nav>

		<!-- Ï¢åÏ∏° Î©îÎâ¥ -->
		<aside th:replace="~{includes/sidebar :: sidebar}"></aside>
		
		<nav th:replace="~{includes/modals/requestOrderAdd :: requestOrderAdd}"></nav>

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- ÏΩòÌÖêÏ∏† Ìó§Îçî (Page header) -->
			<nav th:replace="~{includes/pageHeader :: pageHeader}"></nav>
			
			<!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
			<section class="content">
				<div class="container-fluid">
					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
									<div class="row">
										<div class="col-6">
											<p class="font-weight-bold" style="margin-bottom: 0px; padding-top: 8px;">Ï∂úÌïòÎ™©Î°ù</p>
										</div>
										<div class="col-6">
											<div class="card-tools" style="text-align: right;">
												<input type="button" id="btn_productionOrder_add_row" class="btn btn-primary" value="ÌñâÏ∂îÍ∞Ä" style="display : none;">
												<input type="button" id="btn_productionOrder_remove_row" class="btn btn-primary" value="ÌñâÏÇ≠Ï†ú" style="display : none;">
												<input type="button" id="btn_shipment_request" class="btn btn-primary" value="Ï∂úÌïòÏöîÏ≤≠">
												<input type="button" id="btn_productionOrder_toggleEditMode" class="btn btn-primary" value="Ìé∏Ïßë">
												<input type="button" id="btn_productionOrder_modify" class="btn btn-primary" value="Ï†ÄÏû•">
												<input type="button" id="btn_productionOrder_delete" class="btn btn-primary" value="ÏÇ≠Ï†ú">
											</div>
										</div>
									</div>
								</div>
								<div class="card-body" id="productionOrderGrid">
									<!-- Toast Grid Ajax -->
								</div>
							<!-- /.card-body -->
							</div>
						<!-- /.card -->
						</div>
					<!-- /.col -->
					</div>
				<!-- /.row -->
				<div class="row">
					<div class="col-12">
						<div class="card">
							<div class="card-header">
								<div class="row">
									<div class="col-6">
										<p class="font-weight-bold" style="margin-bottom: 0px; padding-top: 8px;">Ï∂úÌïòÎ™©Î°ùÏÉÅÏÑ∏</p>
									</div>
									<div class="col-6">
										<div class="card-tools" id="btn_group_productionOrderDetail" style="text-align: right; display: none;">
											<input type="button" id="btn_productionOrderDetail_modal" class="btn btn-primary" value="Ï∂îÍ∞Ä">
											<input type="button" id="btn_productionOrderDetail_add" class="btn btn-primary" value="Ï†ÄÏû•">
										</div>
									</div>
								</div>
							</div>
							<div class="card-body" id="productionOrderDetailGrid">
								<!-- Toast Grid Ajax -->
							</div>
						<!-- /.card-body -->
						</div>
					<!-- /.card -->
					</div>
				</div>
				<!-- /.row -->
				</div>
			<!-- /.container-fluid -->
			</section>
		<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->
		<!-- Ï¢åÏ∏° Î©îÎâ¥ -->
		<footer th:replace="~{includes/footer :: footer}"></footer>
		<!-- /.Ï¢åÏ∏° Î©îÎâ¥ -->
		<!-- Control Sidebar -->
		<aside class="control-sidebar control-sidebar-dark">
		<!-- Control sidebar content goes here -->
		</aside>
	<!-- /.control-sidebar -->
	</div>
	<!-- ./wrapper -->
	
	<style>
	    .selected-row {
	        background-color: #d1ffd6;
	    }
	    .deselected-row {
	        background-color: #ffd1d1;
	    }
		.modal-custom-size {
			max-width: 1500px;
		}
	</style>
	
	<!-- Page specific script -->
	<script th:inline="javascript">
		// ÏûëÏóÖÏßÄÏãú
		let productionOrderGrid = null;
		const productionOrderUrl = '/rest/sales/shipmentRequest';
		const productionOrderDataSource = {
			api: {
			    readData: {url: productionOrderUrl, method: 'GET'},
				deleteData: {url: productionOrderUrl, method: 'DELETE', headers: {'X-Delete-IDs': ''}}
			},
			contentType: 'application/json',
		};
		let productionOrderCurrentSelectedRowKey = null;
		let productionOrderCurrentSelectedID = null;
		let productionOrderCurrentSelectedAmount = null;
		let productionOrderCurrentSelectedItem = null;
		let productionOrderIsEditModeEnabled = false; 
		const productionOrder_columns = [
            {header: 'Ï∂úÌïòÎ≤àÌò∏', name: 'SHIPMENT_REQUEST_ID', align: 'center', editor: null},
            {header: 'ÏàòÏ£ºÎ≤àÌò∏', name: 'ORDER_INTAKE_ID', align: 'center', editor: null},
            {header: 'Ï∂úÌïòÏöîÏ≤≠ÏùºÏûê', name: 'REQUEST_DATE', align: 'center', editor: null},
            {header: 'ÏÉÅÌÉú', name: 'STATUS', align: 'left', editor: null},
            {header: 'Ï∂úÌïòÏùºÏûê', name: 'SHIPMENT_COMPLETION_DATE', align: 'right', editor: null},
            {header: 'ÏàòÎüâ', name: 'QUANTITY', align: 'center', editor: null},
        ];
		
		// ÏûëÏóÖÏßÄÏãúÏÉÅÏÑ∏
		let productionOrderDetailGrid = null;
		const productionOrderDetailUrl = '/rest/manufacture/productionOrderDetail';
		const productionOrderDetailDataSource = {
			api: {
				createData: {url: productionOrderDetailUrl, method: 'POST'},
			    readData: {url: productionOrderDetailUrl, method: 'GET', initParams: { productionOrder_id: ''}},
			},
			contentType: 'application/json',
		};
		let productionOrderDetailCurrentSelectedRowKey = null;
		const productionOrderDetail_columns = [
		    {header: 'ÏûëÏóÖÏßÄÏãúÏÉÅÏÑ∏ Î≤àÌò∏', name: 'PRODUCTION_ORDER_DETAIL_ID', align: 'center', editor: null},
		    {header: 'ÌíàÎ™©ÏΩîÎìú', name: 'ITEM_ID', align: 'center', editor: null},
		    {header: 'ÌíàÎ™©Î™Ö', name: 'ITEM_NAME', align: 'left', editor: null},
		    {header: 'ÏÉùÏÇ∞Îüâ', name: 'AMOUNT', align: 'right', editor: null},
		    {header: 'Í∏∞Ï§ÄÎã®ÏúÑ', name: 'ITEM_UNIT', align: 'center', editor: null},
		    {header: 'ÏõåÌÅ¨ÏÑºÌÑ∞ÏΩîÎìú', name: 'WORKCENTER_ID', align: 'center', editor: null},
		    {header: 'ÏõåÌÅ¨ÏÑºÌÑ∞Î™Ö', name: 'WORKCENTER_NAME', align: 'left', editor: null},
		    {header: 'ÏÉÅÌÉú', name: 'STATUS_NAME', align: 'center', editor: null},
		    {header: 'ÏÉÅÌÉúÏΩîÎìú', name: 'STATUS', align: 'center', editor: null, hidden: true},
		    {header: 'ÏûëÏóÖÏßÄÏãú Î≤àÌò∏', name: 'PRODUCTION_ORDER_ID', align: 'center', hidden: true},
		];
		
		class CustomNumberEditor {
		    constructor(props) {
		        const el = document.createElement('input');
		        el.type = 'text'; // Ïà´ÏûêÎßå ÏûÖÎ†• Í∞ÄÎä•ÌïòÎèÑÎ°ù Ï≤òÎ¶¨
		        el.style.width = '100%';
		        el.style.textAlign = 'right';
		        el.value = props.value || '';
		
		        this.el = el;
		    }
		
		    getElement() {
		        return this.el;
		    }
		
		    getValue() {
		        return this.el.value;
		    }
		
		    mounted() {
		        this.el.focus(); // ÏûêÎèô Ìè¨Ïª§Ïä§
		
		        // **ÏûÖÎ†•Ìï† Îïå Ïà´ÏûêÎßå ÎÇ®Í∏∞Í∏∞**
		        this.el.addEventListener('input', (event) => {
		            event.target.value = event.target.value.replace(/[^0-9]/g, '');
		        });
		    }
		}
		
		const TextInputRenderer = function(props) {
			const el = document.createElement('input');
			el.type = 'text';
		 	el.style.width = 'calc(100% - 10px)';
		 	el.style.padding = '6px 7px';
		  	el.style.border = 'solid 1px #ddd';
		  	el.style.margin = 'auto 5px';
		  	
		  	if (props.columnInfo.name == 'AMOUNT'
		  		&& productionOrderGrid.getValue(props.rowKey, 'isNew') == null) {
		  		el.disabled = true;
		  		el.style.border = 'solid 1px white';
		  	}
		  	
		  	this.el = el;
		  	this.render(props);
		}

		TextInputRenderer.prototype.getElement = function () {
			return this.el;
		}
		
		TextInputRenderer.prototype.render = function (props) {
			this.el.value = props.value;
		}
		
		const TextInputBtnRenderer = function(props) {
		    const container = document.createElement('div');
		    container.style.display = 'flex';
		    container.style.alignItems = 'center';
		    container.style.gap = '5px';
		    
		    const el = document.createElement('input');
		    el.type = 'text';
		    el.style.width = 'calc(100% - 10px)';
		    el.style.padding = '6px 7px';
		    el.style.border = 'solid 1px #ddd';
		    el.style.color = 'solid 1px #ddd';
		    el.style.marginLeft = '1px';
		    el.setAttribute('disabled', true); // ÏûÖÎ†• Î∞è ÌÅ¥Î¶≠ ÎπÑÌôúÏÑ±Ìôî
			
			container.appendChild(el);
			
			// PRODUCTION_ORDER_ID Í∏∞Ï°¥Í∞íÏùÄ ÏàòÏ†ï Î∂àÍ∞Ä Ï°∞Í±¥
			if (!((props.columnInfo.name == 'ITEM_ID')
				&& productionOrderGrid.getValue(props.rowKey, 'isNew') == null)) {
				const button = document.createElement('button');
			    button.textContent = 'üîç';
			    button.style.border = 'solid 1px #007BFF';
			    button.style.background = 'white';
			    button.style.color = 'white';
			    button.style.padding = '6px 10px';
			    button.style.cursor = 'pointer';
			    button.style.borderRadius = '4px';
			    button.style.marginRight = '5px';
				
				container.appendChild(button);
					
				button.addEventListener('click', function() {
					const row = props.rowKey;
					const column = props.columnInfo.name;
					// props.formattedValueÎ°ú Í∞ÄÏ†∏Ïò§Î©¥ Î™®Îã¨ Îã§Ïãú ÎùÑÏö∏ Îïå Í∞íÏùÑ Î™ªÎ∞õÏïÑÏò¥.
					const value = productionOrderGrid.getValue(row, column);
					
					switch (column) {
						case 'ITEM_ID': 
							$("#itemRow").val(row);
							$("#itemColumn").val(column);
						
							$('#productionOrderItemAdd').modal();
							
							break;
						case 'WORKCENTER_ID': 
							selectedWorkcenterCell.row = row;
							selectedWorkcenterCell.col = column;
							workcenterDataSource.api.readData.initParams.item_id = processModalSelectedGrid.getValue(row, 'ITEM_ID');
							
							$('#productionOrderWorkcenterAdd').modal();
							
							break;
					}
			    });
			}
			
		    this.el = container;
		    this.input = el;
		    this.render(props);
		}

		TextInputBtnRenderer.prototype.getElement = function () {
		    return this.el;
		}

		TextInputBtnRenderer.prototype.render = function (props) {
		    this.input.value = props.value;
		}
		
		const CheckboxRenderer = function(props) {
		    const el = document.createElement('input');
		    el.type = 'checkbox';
		    el.checked = (props.value === 'Y');  // Ï¥àÍ∏∞Í∞í ÏßÄÏ†ï
			
			// ÏõåÌÅ¨ÏÑºÌÑ∞ ÎπÑÍ∞ÄÎèô Ï§ëÏù¥Í±∞ÎÇò ÏïûÏúºÎ°úÏùò ÏûëÏóÖ ÎåÄÍ∏∞Ïó¥ ÏóÜÏùÑ ÎïåÎßå ÏÇ¨Ïö©Ïó¨Î∂Ä ÏàòÏ†ï Í∞ÄÎä•.
			if (props.grid.getValue(props.rowKey, 'USING_CNT') > 0
				|| props.grid.getValue(props.rowKey, 'USED_N_CNT')) {
				el.disabled = true;
			}
		
			el.addEventListener('change', function() {
		        props.grid.setValue(props.rowKey, props.columnInfo.name, el.checked ? 'Y' : 'N'); // Ï¶âÏãú Í∞í ÏóÖÎç∞Ïù¥Ìä∏
		    });
		    		
		    this.el = el;
		};

		CheckboxRenderer.prototype.getElement = function() {
		    return this.el;
		};

		CheckboxRenderer.prototype.getValue = function() {
		    return this.el.checked ? 'Y' : 'N';
		};

		CheckboxRenderer.prototype.mounted = function() {
		    this.el.focus();
		};

		$(function () {
			productionOrderInit();
		});
		
		// ÏûëÏóÖÏßÄÏãú
		function productionOrderInit() {
			productionOrderGrid = new tui.Grid({
		        el: document.getElementById('productionOrderGrid'),
		        data: productionOrderDataSource,
		        scrollX: true,
		        scrollY: true,
		        bodyHeight: 250,
		        rowHeaders: ['checkbox'],
				editingEvent: 'click',
		        columns: productionOrder_columns,
		    });
			
			productionOrderGrid.on('onGridMounted', () => {
			    // ÌÖåÏù¥Î∏î Ï∂úÎ†• ÏôÑÏ†ÑÌûà ÎÅùÎÇú ÌõÑ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò
			    const checkGridRendered = function() {
				    setTimeout(function() {
			            if (productionOrderGrid.getData().length > 0) {
		 	            	productionOrderGrid.getData().forEach((row, index) => {
		 	            		// Ïù¥ÎØ∏ ÏÉùÏÇ∞Ïóê Îì§Ïñ¥Í∞Ñ ÏûëÏóÖÏßÄÏãúÎäî ÏÇ≠Ï†ú Î∂àÍ∞Ä.
		 				        if (row.DISABLE_CHECK_CNT > 0) {
		 				        	productionOrderGrid.disableRowCheck(index); // Ìï¥Îãπ ÌñâÏùò Ï≤¥ÌÅ¨Î∞ïÏä§Î•º ÎπÑÌôúÏÑ±Ìôî
		 				        }
		 				    });
			            } else {
			                checkGridRendered(); // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Îã§Ïãú Ï≤¥ÌÅ¨
			            }
				    }, 100);
			    };
			    
			    checkGridRendered();
			});
			
		    productionOrderGrid.on('failResponse', function(ev) {
		        alert(JSON.parse(ev.xhr.responseText).message);
		    });
			
			productionOrderGrid.on('editingStart', function(ev) {
			    const {rowKey, columnName, value} = ev;
			    const rowData = productionOrderGrid.getRow(rowKey);
				
				// PK ÏàòÏ†ï Î∂àÍ∞Ä && ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú ÌñâÏùÄ ÏûëÏÑ± Í∞ÄÎä•
// 				if (columnName == 'PRODUCTION_ORDER_ID' && !rowData.isNew) {
// 				if (columnName == 'MANAGER_ID') {
// 					$('#categoryAdd').modal();
// 					ev.stop();
// 				}
			});
			
			productionOrderGrid.on('click', (ev) => {
			    if (ev.targetType != "cell" || productionOrderIsEditModeEnabled) {
					return;
				}

			    const newRowKey = ev.rowKey;
				
				// ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú ÌñâÏùÄ ÌÅ¥Î¶≠ ÏïàÎêòÎèÑÎ°ù.
				if (productionOrderGrid.getRow(newRowKey).isNew) {
					return;
				}

			    if (productionOrderCurrentSelectedRowKey != null) {
			        productionOrderGrid.removeRowClassName(productionOrderCurrentSelectedRowKey, 'selected-row');
			    }

				if (productionOrderDetailGrid) {
					productionOrderDetailGrid.destroy(); // ÏûëÏóÖÏßÄÏãúÏÉÅÏÑ∏ Í∑∏Î¶¨Îìú Ï†úÍ±∞
					productionOrderDetailGrid = null;
				}
				
			    if (productionOrderCurrentSelectedRowKey != newRowKey) {
			        productionOrderGrid.addRowClassName(newRowKey, 'selected-row');
			        productionOrderCurrentSelectedRowKey = newRowKey;
					
					// ÏûëÏóÖÏßÄÏãúÏÉÅÏÑ∏ Í∑∏Î¶¨Îìú ÏÉùÏÑ±
					const productionOrderID = productionOrderGrid.getRow(newRowKey).PRODUCTION_ORDER_ID;
					const orderDetailCount = productionOrderGrid.getRow(newRowKey).ORDER_DETAIL_QUANTITY;
					productionOrderDetailInit(productionOrderID, orderDetailCount);
					
					productionOrderCurrentSelectedID = productionOrderID;
					productionOrderCurrentSelectedAmount = productionOrderGrid.getRow(newRowKey).AMOUNT;
					productionOrderCurrentSelectedItem = productionOrderGrid.getRow(newRowKey).ITEM_ID;
					
// 					$("#btn_group_productionOrderDetail").show();
			    } else {
			        // Í∞ôÏùÄ ÌñâÏùÑ ÌÅ¥Î¶≠Ìïú Í≤ΩÏö∞ ÏÑ†ÌÉù Ìï¥Ï†ú
			        productionOrderCurrentSelectedRowKey = null;
					productionOrderCurrentSelectedID = null;
					productionOrderCurrentSelectedAmount = null;
					productionOrderCurrentSelectedItem = null;
					
					$("#btn_group_productionOrderDetail").hide();
			    }
			});
		}
		
		// ÏàòÏ†ï Î™®Îìú ÌÜ†Í∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏
		$("#btn_productionOrder_toggleEditMode").on("click", function () {
		    productionOrderIsEditModeEnabled = !productionOrderIsEditModeEnabled; // ÏàòÏ†ï Î™®Îìú ÏÉÅÌÉú ÌÜ†Í∏Ä
		    
		    if (productionOrderIsEditModeEnabled) {
				$("#btn_productionOrder_add_row").show();
				$("#btn_productionOrder_remove_row").show();
		    } else {
		    	$("#btn_productionOrder_add_row").hide();
				$("#btn_productionOrder_remove_row").hide();
		    }
		    
		    if (productionOrderIsEditModeEnabled) {
		        productionOrderGrid.setColumns([
		            {header: 'ÏûëÏóÖÏßÄÏãú Î≤àÌò∏', name: 'PRODUCTION_ORDER_ID', align: 'center', editor: null},
		            {header: 'ÏÉùÏÑ±ÏùºÏãú', name: 'CREATE_DATETIME', align: 'center', editor: null},
		            {header: 'ÌíàÎ™©ÏΩîÎìú *', name: 'ITEM_ID', align: 'center', editor: null, renderer: { type: TextInputBtnRenderer }},
		            {header: 'ÌíàÎ™©Î™Ö', name: 'ITEM_NAME', align: 'left', editor: null},
		            {header: 'ÏÉùÏÇ∞Îüâ *', name: 'AMOUNT', align: 'center', editor: { type: CustomNumberEditor }, renderer: { type: TextInputRenderer }},
		            {header: 'Í∏∞Ï§ÄÎã®ÏúÑ', name: 'ITEM_UNIT', align: 'center', editor: null},
		            {header: 'ÏÉÅÌÉú', name: 'SUB_NAME', align: 'center', editor: null},
		            {header: 'ÏÉÅÌÉúÏΩîÎìú', name: 'STATUS', align: 'center', editor: null, hidden: true},
		            {header: 'ÏûëÏóÖÏßÄÏãú Î≤àÌò∏', name: 'PRODUCTION_ORDER_ID', align: 'center', editor: null, hidden: true},
		        ]);
		    } else {
		        productionOrderGrid.finishEditing();  // ÌòÑÏû¨ Ìé∏Ïßë Ï§ëÏù∏ ÏÖÄ Ï¢ÖÎ£åÎ•º ÏïàÌïòÎ©¥ ÏàòÏ†ïÎ™®Îìú Ï¢ÖÎ£åÏãú Í∞íÏù¥ Ï¥àÍ∏∞Ìôî ÎêòÎ≤ÑÎ¶º
		        productionOrderGrid.setColumns(productionOrder_columns);
		    }
		});
		
		function formatDate() {
			let date = new Date();
			let year = date.getFullYear();
			let month = String(date.getMonth() + 1).padStart(2, '0');
			let day = String(date.getDate()).padStart(2, '0');
			
			return `${year}${month}${day}`;
		}

		$("#btn_productionOrder_add_row").on("click", function () {
		    const newRowKey = productionOrderGrid.appendRow(
		        {
		        	"PRODUCTION_ORDER_ID": '',
		        	"CREATE_DATETIME": '',
		        	"ITEM_ID": '',
		        	"ITEM_NAME": '',
		        	"ITEM_UNIT": '',
		        	"AMOUNT": '',
		        	"SUB_NAME": '',
		        	"STATUS": '',
		            isNew: true
		        },
		        {focus: true}
		    );
		});
		
		$("#btn_productionOrder_remove_row").on("click", function () {
		    const rowCount = productionOrderGrid.getRowCount(); // ÌòÑÏû¨ Ìñâ Í∞úÏàò Í∞ÄÏ†∏Ïò§Í∏∞
		    
		    const allRows = productionOrderGrid.getData(); // Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
		    const newRows = allRows.filter(row => row.isNew); // ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú ÌñâÎßå ÌïÑÌÑ∞ÎßÅ
		    
		    if (newRows.length === 0) {
		        alert("ÏÇ≠Ï†úÌï† Ïàò ÏûàÎäî Ïã†Í∑ú ÌñâÏù¥ ÏóÜÏäµÎãàÎã§.");
		        return;
		    }

		    const lastRowKey = productionOrderGrid.getRowAt(rowCount - 1).rowKey; // ÎßàÏßÄÎßâ ÌñâÏùò rowKey Í∞ÄÏ†∏Ïò§Í∏∞
		    productionOrderGrid.removeRow(lastRowKey); // ÎßàÏßÄÎßâ Ìñâ ÏÇ≠Ï†ú
		});

		$("#btn_productionOrder_modify").on("click", function() {
			productionOrderGrid.finishEditing();  // ÌòÑÏû¨ Ìé∏Ïßë Ï§ëÏù∏ ÏÖÄ Ï¢ÖÎ£åÎ•º ÏïàÌïòÎ©¥ Í∞íÏù¥ Ï¥àÍ∏∞Ìôî ÎêòÎ≤ÑÎ¶º
			
		    let createdRows = productionOrderGrid.getModifiedRows().createdRows;
		    let updatedRows = productionOrderGrid.getModifiedRows().updatedRows;
		    
		    // ÌïÑÏàò ÏûÖÎ†• Ïª¨Îüº
		    const requiredFields = ["ITEM_ID", "AMOUNT"];

		    let validCreatedRows = createdRows.filter(row =>
		        requiredFields.every(field => 
		        	row[field] && row[field].trim() !== ''
		        )
		    );
		    
		    let validUpdatedRows = updatedRows.filter(row =>
		        requiredFields.every(field => 
		        	row[field] && row[field].trim() !== ''
		        )
		    );
		    
		    if (createdRows.length == 0 && updatedRows.length == 0) {
		    	alert("ÏàòÏ†ïÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.");
		        return;
		    }

			if (createdRows.length > 0) {
				if ((validCreatedRows.length == 0)
					|| (validCreatedRows.length != createdRows.length)) {
					alert("ÌïÑÏàòÍ∞íÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
			        return;
				}
			}
				
			if (updatedRows.length > 0 && validUpdatedRows.length == 0) {
				alert("ÌïÑÏàòÍ∞íÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
		        return;
			}
			
			productionOrderGrid.request('modifyData');
			productionOrderGrid.readData(1, null, true);  // Í∑∏Î¶¨Îìú ÏÉàÎ°úÍ≥†Ïπ® 
			productionOrderGrid.setColumns(productionOrder_columns);  // ÏàòÏ†ïÎ™®Îìú Ìï¥Ï†ú (ÏÉàÎ°ú Î†åÎçîÎßÅ)
			
			productionOrderIsEditModeEnabled = false;
	    	$("#btn_productionOrder_add_row").hide();
			$("#btn_productionOrder_remove_row").hide();
		});
		
        $("#btn_productionOrder_delete").on("click", function() {
			productionOrderGrid.removeCheckedRows();
			
			// Î∞òÎìúÏãú removeCheckedRows()ÌõÑÏóê Ïã§Ìñâ ÏàúÏÑú
			// DELETEÎäî bodyÍ∞Ä ÏóÜÍ≥† urlÍ≥º headerÎßå ÏûàÏùå, Í∏∞Î≥∏Í∞í url -> urlÎåÄÏã† headerÏóê Îã¥ÏïÑ Î≥¥ÎÉÑ
			const ids = productionOrderGrid.getModifiedRows().deletedRows
				.map(row => encodeURIComponent(row.PRODUCTION_ORDER_ID))  // ÌïúÍ∏Ä Î≥ÄÌôò
				.join(',');
			productionOrderDataSource.api.deleteData.headers['X-Delete-IDs'] = ids;
			
		    productionOrderGrid.request('deleteData');
		    window.location.reload();
// 			productionOrderGrid.reloadData();  // Ïã§Ìå®Ïãú ÌÖåÏù¥Î∏î Î¶¨Î°úÎìú
		});
		
		// ÏûëÏóÖÏßÄÏãúÏÉÅÏÑ∏
		function productionOrderDetailInit(productionOrder_id, orderDetailCount) {
			// ÌååÎùºÎØ∏ÌÑ∞ ÏÑ§Ï†ï
			productionOrderDetailDataSource.api.readData.initParams.productionOrder_id = productionOrder_id;
			
			if (productionOrderDetailGrid) {
				productionOrderDetailGrid.destroy(); // Í∏∞Ï°¥ Í∑∏Î¶¨Îìú Ï†úÍ±∞
				productionOrderDetailGrid = null;
			}
			
			productionOrderDetailGrid = new tui.Grid({
		        el: document.getElementById('productionOrderDetailGrid'),
		        data: productionOrderDetailDataSource,
		        scrollX: true,
		        scrollY: true,
		        bodyHeight: 250,
		        columns: productionOrderDetail_columns,
		    });
			
			if (orderDetailCount > 0) {
				$("#btn_group_productionOrderDetail").hide();
			} else {
				$("#btn_group_productionOrderDetail").show();
			}

		    productionOrderDetailGrid.on('failResponse', function(ev) {
		        alert(JSON.parse(ev.xhr.responseText).message);
		    });
		}
		
		$("#btn_productionOrderDetail_add").on("click", function() {
			productionOrderDetailGrid.request('createData');
			productionOrderDetailGrid.reloadData();  // Ïã§Ìå®Ïãú ÌÖåÏù¥Î∏î Î¶¨Î°úÎìú
		});
		
		$("#btn_productionOrderDetail_modal").on("click", function() {
			processDataSource.api.readData.initParams.amount = productionOrderCurrentSelectedAmount;
			processDataSource.api.readData.initParams.item_id = productionOrderCurrentSelectedItem;
			
			$("#productionOrderDetailAdd").modal();
		});
		
		$("#btn_shipment_request").on("click", function() {
			$("#requestOrderAdd").modal();
		});
	</script>
	
	<nav th:replace="~{includes/modals/mesCodeValidate :: mesCodeValidate}"></nav>
	<nav th:replace="~{includes/modals/productionOrderItemAdd :: productionOrderItemAdd}"></nav>
	<nav th:replace="~{includes/modals/productionOrderDetailAdd :: productionOrderDetailAdd}"></nav>
	<nav th:replace="~{includes/modals/productionOrderWorkcenterAdd :: productionOrderWorkcenterAdd}"></nav>
	
</body>
</html>